# runtime 消息发送机制
- [MarcSteven](https://medium.com/@MarcStevenCoder)
---


当消息发送到对象时，消息传递函数遵循对象的isa指针指向类结构，该指针在类结构中查找调度表中的方法选择器。如果无法在其中找到选择器，则objc_msgSend跟随指向超类的指针，并尝试在其分配表中找到选择器。连续失败导致objc_msgSend爬升类层次结构，直到到达NSObject类。找到选择器后，该函数将调用在表中输入的方法，并将该方法传递给接收对象的数据结构。

为了加快消息传递过程，运行时系统会在使用方法的选择器和地址时对其进行缓存。 每个类都有一个单独的缓存，并且可以包含继承的方法以及该类中定义的方法的选择器。 在搜索调度表之前，消息传递例程首先检查接收对象的类的缓存（根据理论，曾经使用过的方法可能会再次使用）。 如果方法选择器在缓存中，则消息传递仅比函数调用慢一点。 一旦程序运行了足够长的时间以“预热”其缓存，它发送的几乎所有消息都将找到一个缓存方法。 缓存在程序运行时动态增长以容纳新消息。

